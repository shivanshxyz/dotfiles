var sidebarApp=angular.module("sidebarApp",["loginCtrl","signupCtrl","mainPanelCtrl","foldersCtrl","pinCtrl","websitesCtrl","menuFooterCtrl","loadingCtrl","forgetCtrl","questionnaireCtrl","folderList","folder","websiteList","highlightCard","drag","pdfUpload","gistnoteSearchFilter","models","contentScript","RecursionHelper","angular-clipboard","angularMoment","angular.filter","ngSanitize","ngRoute","rt.debounce"]).config(["$routeProvider",function(e){"use strict";e.when("/",{controller:"loadingCtrl",templateUrl:"views/loading.html"}).when("/login",{controller:"loginCtrl",templateUrl:"views/login.html"}).when("/signup",{controller:"signupCtrl",templateUrl:"views/signup.html"}).when("/forget",{controller:"forgetCtrl",templateUrl:"views/forget.html"}).when("/main",{controller:"mainPanelCtrl",templateUrl:"views/main_panel.html"}).when("/citation",{controller:"citationCtrl",templateUrl:"views/citation.html"})}]).config(["$compileProvider",function(e){e.imgSrcSanitizationWhitelist(/^\s*((https?|ftp|file|blob|chrome-extension):|data:image\/)/)}]).directive("autofocus",["$timeout",function(o){return{restrict:"A",link:function(e,t){o(function(){t[0].focus()})}}}]).directive("ngEnter",function(){return function(t,e,o){e.bind("keydown",function(e){13===e.which&&(t.$apply(function(){t.$eval(o.ngEnter,{e:e})}),e.preventDefault())})}}).directive("contenteditable",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,i){function n(){i.$setViewValue(t.html())}i.$render=function(){t.html(i.$viewValue||"")},t.bind("blur keyup change",function(){e.$apply(n)})}}}).run(["$rootScope","$location","models","contentScript",function(e,t,o,i){"use strict";i.init(),e.openOrSwitchToUrl=function(e,t,o){window.top.postMessage({id:"LOG_EVENT",event:"IF_OPEN_OR_SWITCH_TO_URL"},"*"),window.top.postMessage({id:"OPEN_OR_SWITCH_TO_URL",url:e,highlightId:t,pdfPageNumber:o},"*")}}]),citationController=angular.module("citationCtrl",[]);citationController.controller("citationCtrl",["$scope","$rootScope","contentScript",function(e,t,o){}]);var foldersController=angular.module("foldersCtrl",[]);foldersController.controller("foldersCtrl",["$scope","$rootScope","models","contentScript","debounce",function(n,s,r,l,e){"use strict";n.getModelsNow=function(){if(n.creatingFolder=!1,n.subscription=r.subscription,n.folderList=r.folderList,n.activeFolder=r.activeFolder,n.workspace=r.workspace,n.colorCodes=r.colorCodes,n.COLOR_PROFILE=r.COLOR_PROFILE,n.user=r.user,n.workspace&&n.workspace.extensionFolderOrder){var o=[],i={};_.forEach(n.workspace.extensionFolderOrder,function(t){var e=_.findIndex(n.folderList,function(e){return e.folderId===t});-1!==e&&(i[e]=!0,o.push(n.folderList[e]))}),_.forEach(n.folderList,function(e,t){i[t]||o.push(n.folderList[t])}),n.folderList=o}},n.getModels=e(500,n.getModelsNow),r.subscribe(n,n.getModels),n.creatingFolder=!1,n.newFolderName="",n.editingFolder={id:null,title:null,colorTags:["","","","",""]},n.deletingFolderIds=[],n.editingColor=null,n.previousColorCode=null,n.deleteFunction=null,n.deleteConfirmModalShown=!1,n.confirmDelete=function(){n.deleteConfirmModalShown=!1,n.deleteFunction(),n.deleteFunction=null},n.cancelDelete=function(){n.deleteConfirmModalShown=!1,n.deleteFunction=null},n.folderSortOption={axis:"y",distance:10,stop:function(e,t){var o=n.folderList.map(function(e){return e.folderId});l.postWindowMessage({id:"UPDATE_FOLDERS_ORDER",order:o})}},n.showFolderEditPanel=function(){return null!==n.editingFolder.id&&!n.deleteConfirmModalShown&&null===n.editingColor},n.showAllwebsites=function(){},n.deleteFolder=function(e){e.stopPropagation(),n.deleteConfirmModalShown=!0,n.deleteFunction=function(){n.deletingFolderIds.push(n.editingFolder.id),l.postWindowMessage({id:"LOG_EVENT",event:"IF_DELETE_FOLDER"}),l.postWindowMessage({id:"DELETE_FOLDER",folderId:n.editingFolder.id}),n.editingFolder={id:null,title:null,colorTags:["","","","",""],colorCodes:null},s.loading.menuPanel=!1}},n.saveFolderEdit=function(e){e.stopPropagation(),r.folderEditUiUpdate(n.editingFolder.id,n.editingFolder.title,n.editingFolder.colorTags,n.editingFolder.colorCodes);var t=n.editingFolder.title;n.folderNameValidate(t)&&(l.postWindowMessage({id:"LOG_EVENT",event:"IF_EDIT_FOLDER"}),l.postWindowMessage({id:"EDIT_FOLDER",folderId:n.editingFolder.id,title:t,colorTags:n.editingFolder.colorTags,colorCodes:n.editingFolder.colorCodes}),n.editingFolder={id:null,title:null,colorTags:["","","","",""],colorCodes:null},s.loading.menuPanel=!1)},n.createFolder=function(){if(n.user.isAnonymous)return l.postWindowMessage({id:"LOG_EVENT",event:"ANONYMOUS_BLOCK",meta:{reason:"CREATE_FOLDER"}}),void l.postWindowMessage({id:"SHOW_UPGRADE_ANONYMOUS_MODAL"});n.folderNameValidate(n.newFolderName)&&(n.creatingFolder=!0,l.postWindowMessage({id:"LOG_EVENT",event:"IF_CREATE_FOLDER"}),l.postWindowMessage({id:"CREATE_FOLDER",title:n.newFolderName})),n.newFolderName=""},n.folderNameValidate=function(e){return""!==e},n.toggleEditPanel=function(e,t,o){if(e.stopPropagation(),null===t)s.accountsPopoverClass="",s.loading.menuPanel=!1,n.editingFolder={id:null,title:null,colorTags:["","","","",""],colorCodes:null};else{l.postWindowMessage({id:"LOG_EVENT",event:"IF_OPEN_FOLDER_EDIT_PANEL"});var i=o;i&&(s.loading.menuPanel=!0,n.editingFolder={id:t,title:i.title,colorTags:i.colorTags?i.colorTags.slice():["","","","",""],colorCodes:i.colorCodes?i.colorCodes.slice():n.COLOR_PROFILE.slice(0,5)})}},n.getRandomGradient=function(e){return"gradient-"+(e.charCodeAt(0)%6+1)},n.showDeleteButton=function(){return 1!==Object.keys(n.folderList).length||n.editingFolder.id!==Object.keys(n.folderList)[0]},n.getNextColorNum=function(e){for(var t=0;t<e.length;t++)if(!e[t])return t+1;return e.length+1},n.addToHighlightColors=function(){if(l.postWindowMessage({id:"LOG_EVENT",event:"ADD_COLOR",meta:{source:"MENU_PANEL"}}),n.subscription){l.postWindowMessage({id:"LOG_EVENT",event:"ADD_COLOR_SUCCESS"});var e=n.getNextColorNum(n.editingFolder.colorCodes);n.editingFolder.colorCodes[e-1]=n.COLOR_PROFILE[e-1]}else l.postWindowMessage({id:"SHOW_PAYMENT_MODEL"}),l.postWindowMessage({id:"LOG_EVENT",event:"ADD_COLOR_UNPAID"})},n.toggleEditingColors=function(e){l.postWindowMessage({id:"LOG_EVENT",event:"EDIT_COLOR",meta:{source:"MENU_PANEL"}}),n.subscription||null===e||n.user.freePremium?(l.postWindowMessage({id:"LOG_EVENT",event:"EDIT_COLOR_SUCCESS",meta:{source:"MENU_PANEL"}}),n.editingColor=e,n.previousColorCode=e?n.editingFolder.colorCodes[e]:null):(l.postWindowMessage({id:"LOG_EVENT",event:"EDIT_COLOR_UNPAID",meta:{source:"MENU_PANEL"}}),l.postWindowMessage({id:"SHOW_PAYMENT_MODEL"}))},n.onEditColorCancel=function(){n.editingFolder.colorCodes[n.editingColor]=n.previousColorCode,n.toggleEditingColors(null)},n.deleteHighlightColor=function(t){var e=n.activeFolder.websites.filter(function(e){return 0<e.highlights.filter(function(e){return e.colorNum===t}).length}).length;0<e?alert("Cannot delete this color! "+e+" highlights is using that in this collection."):n.editingFolder.colorCodes[t-1]=null},n.getModelsNow()}]);var forgetController=angular.module("forgetCtrl",[]);forgetController.controller("forgetCtrl",["$scope","$location","contentScript",function(e,t,o){"use strict";e.sendEmail=function(){e.email&&o.postWindowMessage({id:"FORGET_PASSWORD",email:e.email})},e.toLogin=function(){t.path("/login").replace()}}]);var headerController=angular.module("menuFooterCtrl",[]);headerController.controller("menuFooterCtrl",["$scope","$rootScope","models","contentScript",function(e,t,o,i){"use strict";e.getModels=function(){e.user=o.user,e.workspace=o.workspace,e.subscription=o.subscription,e.folderList=o.folderList,e.highlightsCount=e.calHighlightsCount(),e.websitesCount=e.calWebsitesCount()},o.subscribe(e,e.getModels),e.tooglePdfHighlight=function(){i.postWindowMessage({id:"HIGHLIGHT_MODE_SETTINGS",highlightModeSettings:e.workspace.extensionHighlightModeSettings})},e.toggleAccountPopover=function(){"show"===t.accountsPopoverClass?(t.accountsPopoverClass="",t.loading.menuPanel=!1):(i.postWindowMessage({id:"LOG_EVENT",event:"IF_SHOW_ACCOUNT_PANEL"}),t.accountsPopoverClass="show",t.loading.menuPanel=!0)},e.editShortcuts=function(){i.postWindowMessage({id:"LOG_EVENT",event:"IF_EDIT_SHORTCUT"}),i.postWindowMessage({id:"OPEN_OR_SWITCH_TO_URL",url:"chrome://extensions/configureCommands",highlightId:null})},e.openAccountDetails=function(){i.postWindowMessage({id:"OPEN_OR_SWITCH_TO_WEAVA_URL",url:"app/dashboard?acctdetails=true",highlightId:null})},e.openContactSupport=function(){i.postWindowMessage({id:"OPEN_OR_SWITCH_TO_URL",url:"https://weavatools.atlassian.net/servicedesk/customer/portals",highlightId:null})},e.openUpvoty=function(){i.postWindowMessage({id:"OPEN_OR_SWITCH_TO_URL",url:"https://weava.upvoty.com/",highlightId:null})},e.calHighlightsCount=function(){var t=0;return _.forEach(this.folderList,function(e){t+=e.highlightsCount||0}),t},e.calWebsitesCount=function(){var t=0;return _.forEach(this.folderList,function(e){t+=e.websitesCount||0}),t},e.signOut=function(){e.user.isAnonymous?confirm("Are you sure to signout? All data in this trial account will be lost")&&(i.postWindowMessage({id:"LOG_EVENT",event:"IF_LOGOUT"}),i.postWindowMessage({id:"HIDE_IFRAME_MENU"}),i.postWindowMessage({id:"SIGN_OUT",title:e.newFolderName})):(i.postWindowMessage({id:"LOG_EVENT",event:"IF_LOGOUT"}),i.postWindowMessage({id:"HIDE_IFRAME_MENU"}),i.postWindowMessage({id:"SIGN_OUT",title:e.newFolderName})),e.toggleAccountPopover()},e.getModels()}]);var loadingController=angular.module("loadingCtrl",[]);loadingController.controller("loadingCtrl",["$scope","$location","$rootScope","contentScript",function(e,n,s,t){s.showReloadButton=!1,s.reloadClicked=!1,s.showPleaseWait=!1,s.reloadExtension=function(){s.reloadClicked=!0,s.showPleaseWait=!0,t.postWindowMessage({id:"RELOAD_EXTENSION"}),setTimeout(function(){s.$apply(function(){s.showPleaseWait=!1})},5e3)},s.onGoToDashboard=function(){t.postWindowMessage({id:"LOG_EVENT",event:"IF_DASHBOARD_BUTTON_CLICKED"}),t.postWindowMessage({id:"GO_TO_LOGIN_PAGE",showInvitations:null})},clearTimeout(s.showReloadButtonTimeout),s.showReloadButtonTimeout=null,s.$on("$routeChangeSuccess",function(e,t,o,i){"/"===n.url()?s.showReloadButtonTimeout=setTimeout(function(){s.$apply(function(){s.showReloadButton=!0})},5e3):(clearTimeout(s.showReloadButtonTimeout),s.showReloadButton=!1)})}]);var loginController=angular.module("loginCtrl",[]);loginController.controller("loginCtrl",["$scope","$location","$rootScope","contentScript",function(e,t,o,i){"use strict";e.email="",e.password="",e.login=function(){""!==e.email&&""!==e.password?i.postWindowMessage({id:"LOGIN",email:e.email,password:e.password}):o.locationPath={path:"LOGIN",errorMessage:"Please enter email and password."}},e.goToLoginPage=function(){i.postWindowMessage({id:"GO_TO_LOGIN_PAGE"})},e.googleLogin=function(){i.postWindowMessage({id:"GOOGLE_LOGIN"})},e.facebookLogin=function(){i.postWindowMessage({id:"FACEBOOK_LOGIN"})},e.toSignup=function(){o.locationPath.errorMessage="",t.path("/signup").replace()},e.toForget=function(){o.locationPath.errorMessage="",t.path("/forget").replace()}}]);var mainPanelController=angular.module("mainPanelCtrl",[]);mainPanelController.controller("mainPanelCtrl",["$rootScope","$scope","models","contentScript","clipboard",function(s,r,i,l,e){"use strict";r.showInput=!1,r.toggleNewCollectionInput=function(e){(r.showInput=e)&&l.postWindowMessage({id:"LOG_EVENT",event:"BG_TRY_CREATE_NESTED_FOLDER",meta:{source:"MAIN_PANEL"}})},s.pdfUploadProgress={current:null,total:null},s.updateUploadProgress=function(e,t){s.pdfUploadProgress=e===t?{current:null,total:null}:{current:e,total:t}},r.PROFILE_ICON_PATH="../../../static/images/svg/profile-icon.svg",r.shareLink="",r.copyButtonText="Click to Copy",r.isRootFolder=function(e,t){return!(!e||!t)&&Object.keys(e).includes(t.folderId)},r.showRateUs=!1,r.showRateUsBanner=!1,r.getModels=function(){r.user=i.user,r.subscription=i.subscription,r.activeFolderIsRoot=r.isRootFolder(i.folderList,i.activeFolder),r.sharingFolderUserMeta=i.sharingFolderUserMeta,r.sharingFolderInvitedMeta=i.sharingFolderInvitedMeta,r.sharingFolderUserMeta&&r.sharingFolderInvitedMeta?r.numberOfCollaborators=Object.keys(r.sharingFolderUserMeta).length+Object.keys(r.sharingFolderInvitedMeta).length:r.numberOfCollaborators=0,r.activeFolderUserMeta=i.activeFolderUserMeta,r.invitationCount=i.folderInvitations?i.folderInvitations.count:0,r.shareLink=s.StaticConstants&&i.activeFolder?s.StaticConstants.APP_BASE_PATH+"app/dashboard;cid="+i.activeFolder.folderId:"",chrome.storage&&chrome.storage.local.get("rateUsBannerResponse",function(e){if((!e.rateUsBannerResponse||"NO"===e.rateUsBannerResponse)&&i.userMeta&&i.userMeta.createdAt){var t=i.userMeta.createdAt,o=new Date(t);r.showRateUs=!r.user.isAnonymous&&864e6<Date.now()-o.getTime()}r.showRateUsBanner=!e.rateUsBannerResponse&&r.showRateUs})},i.subscribe(r,r.getModels),r.clickRateUsBanner=function(){r.showRateUsBanner=!1,l.postWindowMessage({id:"LOG_EVENT",event:"RATE_US_BANNER_CLICKED",meta:{source:"MAIN_PANEL"}}),chrome.storage.local.set({rateUsBannerResponse:"OK"})},r.closeRateUsBanner=function(){r.showRateUsBanner=!1,l.postWindowMessage({id:"LOG_EVENT",event:"RATE_US_BANNER_CLOSED",meta:{source:"MAIN_PANEL"}}),chrome.storage.local.set({rateUsBannerResponse:"NO"})},r.sharingFolder={id:null,title:null,isRoot:null,emailInput:""},r.deletedCollaborator=[],r.deletedInvited=[],r.inputFocused=!1,r._validateEmail=function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},r._validateInvitation=function(t){return!(t in this.sharingFolderInvitedMeta)&&this.sharingFolderUserMeta.every(function(e){return e.email!==t})},r._hideSharePanel=function(){l.postWindowMessage({id:"RESET_FOLDER_COLLABORATION_INFO",folderId:r.sharingFolder.id}),l.postWindowMessage({id:"LOG_EVENT",event:"[COLLABORATION] HIDE_FOLDER_SHARING_PANEL"}),s.loading.mainPanel=!1,s.showShareModal=!1,r.sharingFolder={id:null,title:null,isRoot:null,emailInput:""}},r.upgrade=function(){l.postWindowMessage({id:"LOG_EVENT",event:"GO_TO_PREMIUM_PAGE",meta:{source:"NAV_BAR"}}),window.open("https://www.weavatools.com/premium/")},r.toggleMenu=function(e){s.login&&(e||!s.showMenu?l.postWindowMessage({id:"SHOW_IFRAME_MENU"}):l.postWindowMessage({id:"HIDE_IFRAME_MENU"}),s.accountsPopoverClass="")},r.onCancelInput=function(){r.sharingFolder.emailInput=""},r.submitInvitation=function(){r._validateEmail(r.sharingFolder.emailInput)&&r._validateInvitation(r.sharingFolder.emailInput)&&(l.postWindowMessage({id:"INVITE_COLLABORATOR",folderId:r.sharingFolder.id,emailInput:r.sharingFolder.emailInput,title:r.sharingFolder.title}),r.sharingFolderInvitedMeta[r.sharingFolder.emailInput]="write",r.sharingFolder.emailInput="")},r.onRemoveCollaborator=function(e){l.postWindowMessage({id:"LOG_EVENT",event:"[COLLABORATION] REMOVE_USER_CLICKED"}),r.deletedCollaborator.push(e)},r.onRemoveInvited=function(e){l.postWindowMessage({id:"LOG_EVENT",event:"[COLLABORATION] DELETE_INVITATION_CLICKED"}),r.deletedInvited.push(e)},r.onCancel=function(){r.deletedCollaborator=[],r.deletedInvited=[]},r.onSave=function(){l.postWindowMessage({id:"DELETE_COLLABORATORS",deletedCollaborator:r.deletedCollaborator,deletedInvited:r.deletedInvited,folderId:r.sharingFolder.id}),r.deletedCollaborator=[],r.deletedInvited=[],r._hideSharePanel()},r.toggleSharePanel=function(e,t,o,i,n){if(e.stopPropagation(),r.user.isAnonymous)return l.postWindowMessage({id:"LOG_EVENT",event:"ANONYMOUS_BLOCK",meta:{reason:"SHOW_FOLDER_SHARING_PANEL"}}),void l.postWindowMessage({id:"SHOW_UPGRADE_ANONYMOUS_MODAL"});t&&o?(l.postWindowMessage({id:"RESET_FOLDER_COLLABORATION_INFO",folderId:r.sharingFolder.id}),l.postWindowMessage({id:"QUERY_FOLDER_COLLABORATION_INFO",folderId:t}),l.postWindowMessage({id:"LOG_EVENT",event:"[COLLABORATION] SHOW_FOLDER_SHARING_PANEL",meta:{isRoot:i,source:n}}),r.toggleMenu(!0),s.showShareModal=!0,s.loading.mainPanel=!0,r.sharingFolder={id:t,title:o.title,isRoot:i,emailInput:""}):r._hideSharePanel()},r.setInputFocused=function(e){r.inputFocused=e},r.hasUnsavedChange=function(){return 0!==this.deletedCollaborator.length||0!==this.deletedInvited.length},r.hoverButtonOnClick=function(){l.postWindowMessage({id:"LOG_EVENT",event:"[COLLABORATION] COPY_SHARE_LINK"}),this.copyButtonText="Copied!",e.copyText(r.shareLink),setTimeout(function(){r.copyButtonText="Click to Copy"},3e3)},r.onHomeButtonClick=function(){var e=0<r.invitationCount;l.postWindowMessage({id:"LOG_EVENT",event:"IF_HOME_BUTTON_CLICKED"}),l.postWindowMessage({id:"GO_TO_LOGIN_PAGE",showInvitations:e})},r.onGoToDashboardClick=function(){var e=0<r.invitationCount;l.postWindowMessage({id:"LOG_EVENT",event:"IF_DASHBOARD_BUTTON_CLICKED"}),l.postWindowMessage({id:"GO_TO_LOGIN_PAGE",showInvitations:e})},r.loadingSearchResult=function(e,t,o){var i=t&&3<t.length&&t!==e.searchResult.searchStr,n=e.searchResult.colors&&e.searchResult.colors.length!==o.length;return i||n},s.showReloadButton=!1,s.reloadClicked=!1,s.reloadExtension=function(){s.reloadClicked=!0,l.postWindowMessage({id:"RELOAD_EXTENSION"})},clearTimeout(s.showReloadButtonTimeout),s.showReloadButtonTimeout=null,s.$watch("currentSwitchingFolderId",function(){s.currentSwitchingFolderId?s.showReloadButtonTimeout=setTimeout(function(){s.$apply(function(){s.showReloadButton=!0})},5e3):(clearTimeout(s.showReloadButtonTimeout),s.showReloadButton=!1)}),r.linkToActualAccount=function(){l.postWindowMessage({id:"GO_TO_LINK_ACCOUNT_PAGE"})},r.clickRateUs=function(){chrome.storage.local.set({rateUsBannerResponse:"OK"}),l.postWindowMessage({id:"LOG_EVENT",event:"RATE_US_BUTTON_CLICKED",meta:{source:"MENU_PANEL"}})},r.getModels()}]);var pinController=angular.module("pinCtrl",[]);pinController.controller("pinCtrl",["$scope","contentScript",function(e,t){"use strict";e.togglePinMode=function(){t.postWindowMessage({id:"LOG_EVENT",event:"IF_TOOGLE_PIN"}),t.postWindowMessage({id:"TOGGLE_PIN_MODE_BY_SIDEBAR"})}}]);var questionnaireController=angular.module("questionnaireCtrl",[]);questionnaireController.controller("questionnaireCtrl",["$scope","$rootScope","contentScript",function(e,t,o){e.userRole="",e.studyField="",e.expertField="",e.submitAttempted=!1,e.submit=function(){o.postWindowMessage({id:"SUBMIT_QUESTIONNAIRE",questionnaire:{userRole:{role:e.userRole,studyField:e.studyField,expectField:e.expertField}}}),e.submitAttempted=!0}}]);var signupController=angular.module("signupCtrl",[]);signupController.controller("signupCtrl",["$scope","$location","$rootScope","contentScript",function(e,t,o,i){"use strict";e.email="",e.password="",e.firstName="",e.lastName="",e.showEmailSignUp=!1,e.showEmail=function(){e.showEmailSignUp=!0},e.signup=function(){""!==e.email&&""!==e.password?""!==e.firstName&&""!==e.lastName?i.postWindowMessage({id:"SIGNUP",displayName:e.firstName+" "+e.lastName,email:e.email,password:e.password}):o.locationPath={path:"SIGNUP",errorMessage:"Please enter your name."}:o.locationPath={path:"SIGNUP",errorMessage:"Please enter email and password."}},e.googleLogin=function(){i.postWindowMessage({id:"GOOGLE_LOGIN"})},e.facebookLogin=function(){i.postWindowMessage({id:"FACEBOOK_LOGIN"})},e.toLogin=function(){o.locationPath.errorMessage="",t.path("/login").replace()}}]);var websitesController=angular.module("websitesCtrl",[]);websitesController.controller("websitesCtrl",["$scope","$rootScope","models","contentScript","debounce",function(s,r,o,l,e){"use strict";s._LATEST_NOTIFICATION="1.10.2",s.showDiscountCard=!1,s.getModels=e(500,function(){if(o.activeFolder){o.activeFolder.searchState.searchResult.websiteIds&&(s.hidingHighlightsWebpages=[]),(!s.activeFolder&&o.activeFolder||s.activeFolder.folderId!==o.activeFolder.folderId)&&(s.activeColorFilters=[],_.forEach(o.activeFolder.websiteIds,function(e,t){-1===s.hidingHighlightsWebpages.indexOf(t)&&s.hidingHighlightsWebpages.push(t)}),_.forEach(o.activeFolder.websites,function(e){if(e.active){var t=s.hidingHighlightsWebpages.indexOf(e.websiteId);-1!==t&&s.hidingHighlightsWebpages.splice(t,1)}})),o.activeFolder.folderId===r.currentSwitchingFolderId&&(r.currentSwitchingFolderId=null),s.folderList=o.folderList,s.activeFolder=o.activeFolder,s.workspace=o.workspace,s.colorCodes=o.colorCodes,s.COLOR_PROFILE=o.COLOR_PROFILE,s.subscription=o.subscription,s.user=o.user;if(o.userMeta&&o.userMeta.createdAt){var e=o.userMeta.createdAt;new Date(e).getTime()+864e5>Date.now()}chrome.storage&&chrome.storage.local.get(["promotionClosedDate"],function(e){s.showDiscountCard=!s.subscription&&!s.user.isAnonymous&&(e.promotionClosedDate&&432e6<Date.now()-e.promotionClosedDate||!e.promotionClosedDate)}),s.showHighlightModeGuide=o.onboarding&&4===o.onboarding.extensionGuideState,s.questionnaire=o.questionnaire}}),s.isEmptyFolder=function(){return s.activeFolder&&!s.activeFolder.websiteIds&&0===Object.keys(s.activeFolder.folderMetaMap).length},s.resetSlidingWindow=function(){$(".gistnote-main-panel").scrollTop(0),s.websiteSlidingWindow={start:0,end:20<s.activeFolder.websites.length?19:s.activeFolder.websites.length-1,step:2}},s.slideWebsiteListForward=function(){s.websiteSlidingWindow.end<s.activeFolder.websites.length-1&&(s.websiteSlidingWindow.end+s.websiteSlidingWindow.step<s.activeFolder.websites.length?(s.websiteSlidingWindow.start+=s.websiteSlidingWindow.step,s.websiteSlidingWindow.end+=s.websiteSlidingWindow.step):(s.websiteSlidingWindow.start+=s.websiteSlidingWindow.step,s.websiteSlidingWindow.end=s.activeFolder.websites.length-1))},s.slideWebsiteListBackward=function(){0<s.websiteSlidingWindow.start&&(0<=s.websiteSlidingWindow.start-s.websiteSlidingWindow.step?s.websiteSlidingWindow.start-=s.websiteSlidingWindow.step:s.websiteSlidingWindow.start=0,s.websiteSlidingWindow.end-=s.websiteSlidingWindow.step)},o.subscribe(s,s.getModels),s.questionnaireForm={userRole:"",studyField:"",expertField:"",reading:""},s.showDropDown=!1,s.activeColorFilters=[],s.hidingHighlightsWebpages=[],s.editingFolder={id:null,title:null,colorTags:["","","","",""],colorCodes:null},s.editingColor=null,s.previousColorCode=null,s.editPanelStyle={top:80},s.userRoleOptions=[["student","Student"],["professional","Professional"],["leisure","Leisure User"]],s.studyFieldsOptions=[["high_school","I'm in high school"],["art_and_humanities","Arts & Humanities"],["law_and_politics","Law & Politics"],["social_sciences","Social Sciences"],["science","Science"],["engineering","Engineering"],["medicine","Medicine"],["business_management","Business Management"],["psychology_and_education","Psychology & Education"]],s.expertFieldsOptions=[["writer_or_journalist","Writer / Journalist"],["pr_or_communications","PR / Communications"],["market_researcher","Marketing Researcher"],["lawyer","Lawyer"],["education","Education"],["developer","Developer"],["medicine_related","Medicine-related"],["business_management","Business Management"],["researcher","Researcher"],["other","Other"]],s.readingOptions=[["studying_materials","Studying Materials"],["academic_research","Research (Academic)"],["work_research","Research (Work / Other)"],["documentations","Documentations"],["casual_readings","Casual Reading"]],s.shuffleOptions=function(e){for(var t=e.length;t;t--){var o=Math.floor(Math.random()*t),i=e[t-1];e[t-1]=e[o],e[o]=i}},s.shuffleOptions(s.userRoleOptions),s.shuffleOptions(s.studyFieldsOptions),s.shuffleOptions(s.expertFieldsOptions),s.shuffleOptions(s.readingOptions),s.submitPersonaQuestionnaire=function(){s.showQuestionnaireModal=!1,l.postWindowMessage({id:"LOG_EVENT",event:"SUBMIT_PERSONA_QUESTIONNAIRE"})},s.closeHighlightModeGuide=function(){s.showHighlightModeGuide=!1,l.postWindowMessage({id:"LOG_EVENT",event:"GUIDE_CLOSE_HIGHLIGHT_MODE",meta:{source:"MAIN_PANEL"}}),l.postWindowMessage({id:"CLOSE_HIGHLIGHT_MODE_GUIDE"})},s.colorCircleClick=function(e){var t=s.activeColorFilters.indexOf(e);-1!==t?s.activeColorFilters.splice(t,1):s.activeColorFilters.push(e),3<=r.search.input.length&&s.submitSearchStr()},s.hidingAllHighlights=!1,s.expandAllHighlights=function(){s.hidingAllHighlights=!1,s.hidingHighlightsWebpages=[],l.postWindowMessage({id:"LOG_EVENT",event:"[MAIN_PANEL] SHOW_ALL_HIGHLIGHTS"})},s.hideAllHighlights=function(){s.hidingAllHighlights=!0,s.activeFolder.searchState.searching?s.hidingHighlightsWebpages=_.map(s.activeFolder.searchWebsites,function(e){return e.websiteId}):s.hidingHighlightsWebpages=_.map(s.activeFolder.websites,function(e){return e.websiteId}),l.postWindowMessage({id:"LOG_EVENT",event:"[MAIN_PANEL] HIDE_ALL_HIGHLIGHTS"})},s.toggleHighlightMode=function(){l.postWindowMessage({id:"LOG_EVENT",event:"TOGGLE_HIGHLIGHT_MODE",meta:{source:"MAIN_PANEL",mode:!s.workspace.extensionHighlightModeSettings.highlighter}}),l.postWindowMessage({id:"HIGHLIGHT_MODE_SETTINGS",highlightModeSettings:s.workspace.extensionHighlightModeSettings}),s.showHighlightModeGuide&&s.closeHighlightModeGuide()},s.showSearch=function(){l.postWindowMessage({id:"LOG_EVENT",event:"IF_SHOW_SEARCH"}),r.search.show=!0,r.search.input=""},s.hideSearch=function(){l.postWindowMessage({id:"LOG_EVENT",event:"IF_HIDE_SEARCH"}),l.postWindowMessage({id:"EXIT_SEARCH_MODE"}),r.search.show=!1,r.search.input="",s.activeColorFilters=[]},s.getWebsiteListWrapperClass=function(e){return r.search.show?e.searching?"searched":"searching":""},s.toggleEditPanel=function(e,t,o){if(e.stopPropagation(),null===t)r.accountsPopoverClass="",r.loading.mainPanel=!1,s.editingFolder={id:null,title:null,colorTags:["","","","",""],colorCodes:null};else{l.postWindowMessage({id:"LOG_EVENT",event:"IF_OPEN_FOLDER_EDIT_PANEL"});var i=o;if(i){s.editPanelStyle={top:30};var n=$(".gistnote-main-panel").scrollTop()+80;s.editPanelStyle={top:n},r.loading.mainPanel=!0,s.editingFolder={id:t,title:i.title,colorTags:i.colorTags?i.colorTags.slice():["","","","",""],colorCodes:s.colorCodes.slice()}}}},s.saveFolderEdit=function(e){e.stopPropagation(),o.folderEditUiUpdate(s.editingFolder.id,s.editingFolder.title,s.editingFolder.colorTags,s.editingFolder.colorCodes);var t=s.editingFolder.title;s.folderNameValidate(t)&&(l.postWindowMessage({id:"LOG_EVENT",event:"IF_EDIT_FOLDER"}),l.postWindowMessage({id:"EDIT_FOLDER",folderId:s.editingFolder.id,title:t,colorTags:s.editingFolder.colorTags,colorCodes:s.editingFolder.colorCodes}),s.editingFolder={id:null,title:null,colorTags:["","","","",""],colorCodes:null},r.loading.mainPanel=!1,s.toggleEditingColors(null))},s.createNestedCollection=function(e,t){if(e.stopPropagation(),s.user.isAnonymous)return l.postWindowMessage({id:"LOG_EVENT",event:"ANONYMOUS_BLOCK",meta:{reason:"CREATE_NESTED_FOLDER"}}),void l.postWindowMessage({id:"SHOW_UPGRADE_ANONYMOUS_MODAL"});s.creatingFolder=!0,l.postWindowMessage({id:"LOG_EVENT",event:"BG_TRY_CREATE_NESTED_FOLDER",meta:{source:"MENU_PANEL"}}),l.postWindowMessage({id:"CREATE_NESTED_FOLDER",parentId:t})},s.folderNameValidate=function(e){return""!==e},s.onNewFeatureClick=function(){s.showNewFeatureCard=!1;var e="https://resources.weavatools.com/desktop-app-releases/";-1!==window.navigator.userAgent.indexOf("Window")?e+="window/Weava+Setup+1.1.3.exe":e+="mac/Weava-1.1.3.dmg",window.open(e),l.postWindowMessage({id:"LOG_EVENT",event:"CLOSE_NEW_FEATURE_NOTIFICATION_MODAL",meta:{version:s._LATEST_NOTIFICATION,action:!0}}),l.postWindowMessage({id:"CLOSE_NOTIFICATION_MODAL"})},s.onDiscountClick=function(e){e.stopPropagation(),l.postWindowMessage({id:"LOG_EVENT",event:"GO_TO_PREMIUM_PAGE",meta:{source:"MAIN_PANEL"}}),window.open("https://www.weavatools.com/premium")},s.signOut=function(){s.user.isAnonymous?confirm("Are you sure to signout? All data in this trial account will be lost.")&&(l.postWindowMessage({id:"LOG_EVENT",event:"IF_LOGOUT"}),l.postWindowMessage({id:"HIDE_IFRAME_MENU"}),l.postWindowMessage({id:"SIGN_OUT",title:s.newFolderName})):(l.postWindowMessage({id:"LOG_EVENT",event:"IF_LOGOUT"}),l.postWindowMessage({id:"HIDE_IFRAME_MENU"}),l.postWindowMessage({id:"SIGN_OUT",title:s.newFolderName})),s.toggleAccountPopover()},s.onSignInClick=function(e){e.stopPropagation(),l.postWindowMessage({id:"LOG_EVENT",event:"GO_TO_LINK_ACCOUNT_PAGE",meta:{source:"MAIN_PANEL"}}),l.postWindowMessage({id:"GO_TO_LINK_ACCOUNT_PAGE"})},s.closeNotificationModal=function(e){e.stopPropagation(),s.showNewFeatureCard=!1,l.postWindowMessage({id:"LOG_EVENT",event:"CLOSE_NEW_FEATURE_NOTIFICATION_MODAL",meta:{version:s._LATEST_NOTIFICATION,action:!1}}),l.postWindowMessage({id:"CLOSE_NOTIFICATION_MODAL"})},s.closeDiscountModal=function(e){e.stopPropagation(),s.showDiscountCard=!1,l.postWindowMessage({id:"LOG_EVENT",event:"CLOSE_DISCOUNT_MODAL",meta:{version:s._LATEST_NOTIFICATION}}),chrome.storage.local.get("promotionClosedDate",function(e){chrome.storage.local.set({promotionClosedDate:Date.now()})})},s.clickSortOption=function(e){s.showDropDown=!1,l.postWindowMessage({id:"CHANGE_WEBSITE_ORDER",ascending:e})},s.submitSearchStr=function(){3<=r.search.input.length&&l.postWindowMessage({id:"SEARCH_IN_FOLDER",folderId:s.activeFolder.folderId,searchStr:r.search.input,colorFilters:s.activeColorFilters})},s.getNextColorNum=function(e){for(var t=0;t<e.length;t++)if(!e[t])return t+1;return e.length+1},s.addToHighlightColors=function(){if(l.postWindowMessage({id:"LOG_EVENT",event:"ADD_COLOR",meta:{source:"MAIN_PANEL"}}),s.subscription){l.postWindowMessage({id:"LOG_EVENT",event:"ADD_COLOR_SUCCESS"});var e=s.getNextColorNum(s.editingFolder.colorCodes);s.editingFolder.colorCodes[e-1]=s.COLOR_PROFILE[e-1]}else l.postWindowMessage({id:"SHOW_PAYMENT_MODEL"}),l.postWindowMessage({id:"LOG_EVENT",event:"ADD_COLOR_UNPAID"})},s.toggleEditingColors=function(e){l.postWindowMessage({id:"LOG_EVENT",event:"EDIT_COLOR",meta:{source:"MAIN_PANEL"}}),s.subscription||null===e||s.user.freePremium?(l.postWindowMessage({id:"LOG_EVENT",event:"EDIT_COLOR_SUCCESS",meta:{source:"MAIN_PANEL"}}),s.editingColor=e,s.previousColorCode=e?s.editingFolder.colorCodes[e]:null):(l.postWindowMessage({id:"LOG_EVENT",event:"EDIT_COLOR_UNPAID",meta:{source:"MAIN_PANEL"}}),l.postWindowMessage({id:"SHOW_PAYMENT_MODEL"}))},s.onEditColorCancel=function(){s.editingFolder.colorCodes[s.editingColor]=s.previousColorCode,s.toggleEditingColors(null)},s.deleteHighlightColor=function(t){l.postWindowMessage({id:"LOG_EVENT",event:"DELETE_COLOR"});var e=s.activeFolder.websites.filter(function(e){return 0<e.highlights.filter(function(e){return e.colorNum===t}).length}).length;0<e?alert("Cannot delete this color! "+e+" highlights is using that in this collection."):s.editingFolder.colorCodes[t-1]=null},s.getModels(),s.deleteConfirmModalShown=!1,s.showDeleteButton=function(){return 1!==Object.keys(s.folderList).length||s.editingFolder.id!==Object.keys(s.folderList)[0]},s.deleteFolder=function(e){e.stopPropagation(),s.deleteConfirmModalShown=!0,l.postWindowMessage({id:"LOG_EVENT",event:"IF_DELETE_FOLDER"}),l.postWindowMessage({id:"DELETE_FOLDER",folderId:s.editingFolder.id}),s.editingFolder={id:null,title:null,colorTags:["","","","",""],colorCodes:null},r.loading.mainPanel=!1}}]),angular.module("drag",[]).directive("canDrag",["$rootScope","contentScript","$filter","clipboard",function(i,n,e,t){return{restrict:"A",link:function(e,t,o){t.prop("draggable",!0),t.on("dragstart",function(e){switch(t[0].style.opacity="0.3",e.dataTransfer=e.originalEvent.dataTransfer,n.postWindowMessage({id:"SHOW_IFRAME_MENU"}),n.postWindowMessage({id:"LOG_EVENT",event:"DRAG_"+o.draggingType}),o.draggingType){case"WEBSITE":e.dataTransfer.setData("data",JSON.stringify({type:o.draggingType,websiteId:o.draggingWebsiteId}));break;case"HIGHLIGHT":e.dataTransfer.setData("data",JSON.stringify({type:o.draggingType,websiteId:o.draggingWebsiteId,highlightId:o.draggingHighlightId}));break;case"FOLDER":i.draggingFolder=!0,e.dataTransfer.setData("data",JSON.stringify({type:o.draggingType,folderId:o.draggingFolderId}))}}),t.on("dragend",function(e){t[0].style.opacity="1"})}}}]).directive("canDrop",["$rootScope","contentScript","$filter","clipboard",function(e,i,t,o){return{restrict:"A",link:function(e,t,o){t.on("dragover",function(e){e.preventDefault(),e.stopPropagation(),$(".drag-over-"+o.toFolderId).addClass("dragover")}),t.on("dragleave",function(e){e.preventDefault(),e.stopPropagation(),$(".drag-over-"+o.toFolderId).removeClass("dragover")}),t.on("drop",function(e){e.dataTransfer=e.originalEvent.dataTransfer,e.preventDefault(),e.stopPropagation(),$(".drag-over-"+o.toFolderId).removeClass("dragover");var t=JSON.parse(e.dataTransfer.getData("data"));switch(i.postWindowMessage({id:"LOG_EVENT",event:"DROP_"+t.type}),t.type){case"WEBSITE":i.postWindowMessage({id:"MOVE_WEBSITE",fromFolderId:o.fromFolderId,toFolderId:o.toFolderId,websiteId:t.websiteId});break;case"HIGHLIGHT":i.postWindowMessage({id:"MOVE_HIGHLIGHT",fromFolderId:o.fromFolderId,toFolderId:o.toFolderId,websiteId:t.websiteId,highlightId:t.highlightId});break;case"FOLDER":i.postWindowMessage({id:"MOVE_FOLDER",fromFolderId:t.folderId,toFolderId:o.toFolderId})}})}}}]),angular.module("folder",[]).directive("folder",["RecursionHelper","$rootScope","contentScript",function(t,s,r){return{restrict:"E",scope:{user:"=",folder:"=",folderId:"=",activeFolder:"=",openEditPanel:"=",toggleSharePanel:"=",deletingFolderIds:"=",root:"="},templateUrl:"views/folder.html",compile:function(e){return t.compile(e,function(n,e,t,o,i){n.hovered=!1,n.creatingFolder=!1,n.hasSubFolder=!1,n.$watch("folder",function(){n.creatingFolder=!1,n.hasSubFolder=0<Object.keys(n.folder.folderMetaMap).length}),n.initUnFolded=function(){var i=function(e){if(e.active)return!0;if(e.folderMetaMap){for(var t=Object.keys(e.folderMetaMap),o=0;o<t.length;o++)if(i(e.folderMetaMap[t[o]]))return!0;return!1}return!1},e=!1;if(n.folder.folderMetaMap)for(var t=Object.keys(n.folder.folderMetaMap),o=0;o<t.length;o++)if(i(n.folder.folderMetaMap[t[o]])){e=!0;break}n.unFolded=e},n.unFolded=!1,n.initUnFolded(),n.unFoldChild=function(){n.unFolded=!n.unFolded},n.isActiveFolder=function(){return!s.currentSwitchingFolderId&&n.folder.active||s.currentSwitchingFolderId===n.folder.folderId},n.switchFolder=function(e){n.activeFolder.folderId!==e&&n.activeFolder.folderId!==s.currentSwitchingFolderId&&e!==s.currentSwitchingFolderId?(s.currentSwitchingFolderId=e,s.search.show=!1,r.postWindowMessage({id:"LOG_EVENT",event:"SWITCH_FOLDER",meta:{source:"MENU_PANEL",isRoot:n.root}}),r.postWindowMessage({id:"SWITCH_FOLDER",folderId:e})):n.unFoldChild()},n.createNestedCollection=function(e,t){if(e.stopPropagation(),n.user.isAnonymous)return r.postWindowMessage({id:"LOG_EVENT",event:"ANONYMOUS_BLOCK",meta:{reason:"CREATE_NESTED_FOLDER"}}),void r.postWindowMessage({id:"SHOW_UPGRADE_ANONYMOUS_MODAL"});n.creatingFolder=!0,n.unFolded=!0,r.postWindowMessage({id:"LOG_EVENT",event:"BG_TRY_CREATE_NESTED_FOLDER",meta:{source:"MENU_PANEL"}}),r.postWindowMessage({id:"CREATE_NESTED_FOLDER",parentId:t})}})}}}]),angular.module("folderList",[]).directive("folderList",["RecursionHelper","$rootScope","contentScript",function(t,e,o){return{restrict:"E",scope:{user:"=",folderList:"=",activeFolder:"=",openEditPanel:"=",toggleSharePanel:"=",root:"=",deletingFolderIds:"="},templateUrl:"views/folderList.html",compile:function(e){return t.compile(e,function(i,e,t,o,n){i.folderArr=[],i.run=function(){var o=[];_.forEach(i.folderList,function(e,t){e.folderId=t,-1===i.deletingFolderIds.indexOf(t)&&o.push(e)}),i.root?o.sort(function(e,t){return e.createDate-t.createDate}):o.sort(function(e,t){return e.order-t.order}),i.folderArr=o},i.$watch("deletingFolderIds",function(e,t){i.run()},!0),i.$watch("folderList",function(e,t){i.run()},!0)})}}}]),angular.module("highlightCard",[]).directive("highlightCard",["$rootScope","contentScript","$filter","clipboard","$timeout",function(o,i,e,n,r){return{restrict:"E",scope:{activeFolderUserMeta:"=",activeFolder:"=",website:"=",highlight:"=",goToWebsite:"=",colorCodes:"=",triggerDeleteConfirmation:"="},templateUrl:"views/highlightCard.html",link:function(s,e,t){s.StaticConstants=o.StaticConstants,s.ANONOYMOUS_PHOTO_PATH="../../../static/images/svg/profile-icon.svg",s.ANONOYMOUS_NAME="(anonymous)",s.HIGHLIGHT_MAX_HEIGHT=70,s.SAVING="saving...",s.SAVED="saved",s.hovering=!1,s.editingNote={text:null,history:[]},s.showingMore=!1,s.getHighlightHtml=function(){var e=s.highlight.text;if(s.highlight.text&&s.activeFolder.searchState.searchResult.websiteIds)for(var t=0;t<s.activeFolder.searchState.searchResult.websiteIds.length;t++)if(s.website.websiteId===s.activeFolder.searchState.searchResult.websiteIds[t].websiteId)for(var o=_.uniq(s.activeFolder.searchState.searchResult.websiteIds[t].matchedTexts),i=0;i<o.length;i++){var n=o[i];n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),e=e.replace(new RegExp("("+n+")","g"),"<!_!>$1</!_!>")}return e=(e=e.replace(new RegExp("<!_!>","g"),'<span class="search-match">')).replace(new RegExp("</!_!>","g"),"</span>")},s.$watch("highlight",function(){if(s.editingNote.text!==s.highlight.note){var e=s.editingNote.history.indexOf(s.highlight.note);-1===e?s.editingNote.text=s.highlight.note:s.editingNote.history.splice(e,1)}}),r(function(){var e=document.getElementById(s.highlight.highlightId+"-text-wrapper");s.isOverflown=!!e&&(e.scrollHeight>e.clientHeight||e.offsetHeight>s.HIGHLIGHT_MAX_HEIGHT)}),s.showMore=function(e){e.stopPropagation(),s.showingMore=!0,i.postWindowMessage({id:"LOG_EVENT",event:"IF_SHOW_MORE"})},s.showLess=function(e){e.stopPropagation(),s.showingMore=!1,i.postWindowMessage({id:"LOG_EVENT",event:"IF_SHOW_LESS"})},s.addHighlightNote=function(e){e.stopPropagation(),s.editingNote.text="",setTimeout(function(){$("#highlight-note-"+s.highlight.highlightId).focus()},200)},s.deleteHighlightNote=function(e){e.stopPropagation(),s.highlight.note=null,s.editingNote.text=null,s._saveNow()},s.onNoteMouseOver=function(){s.hovering=!0},s.onNoteMouseLeave=function(){s.hovering=!1},s.highlightNoteAutoGrowHeight=function(e){var t="object"==typeof e?e.target:document.getElementById(e),o=t.scrollHeight-4;t.setAttribute("style","height: "+o+"px; !important")},s._saveNow=function(){i.postWindowMessage({id:"LOG_EVENT",event:"IF_EDIT_NOTE"}),i.postWindowMessage({id:"EDIT_NOTE",folderId:s.activeFolder.folderId,websiteId:s.website.websiteId,highlightId:s.highlight.highlightId,note:s.editingNote.text?s.editingNote.text:null}),s.editingNote.history.push(s.editingNote.text),s.noteSavingState=null},s._autoSave=gistDebounce(1e3,function(){s._saveNow()}.bind(this)),s.saveHighlightNote=function(e){e&&e.target&&0===e.target.innerText.replace(/\s/g,"").length&&(s.editingNote.text=null),s.noteSavingState=s.highlight.highlightId,s._autoSave()},s.getNoteSavingState=function(){return s.noteSavingState===s.highlight.highlightId||s.hovering?s.noteSavingState?s.SAVING:s.SAVED:""},s.copyHighlight=function(e){e.stopPropagation();var t=s.highlight.text;if(s.highlight.note){var o=document.createElement("div");o.innerHTML=s.highlight.note,t+="\n"+o.innerText}n.copyText(t),s.copySuccess()},s.deleteHighlight=function(e){e.stopPropagation(),s.triggerDeleteConfirmation(function(){var e=_.findIndex(s.website.highlights,function(e){return e.highlightId===s.highlight.highlightId});i.postWindowMessage({id:"LOG_EVENT",event:"IF_DELETE_HIGHLIGHT"}),i.postWindowMessage({id:"DELETE_HIGHLIGHT",websiteId:s.website.websiteId,highlightId:s.highlight.highlightId}),s.website.highlights.splice(e,1)})},s.deleteImage=function(e){e.stopPropagation(),s.triggerDeleteConfirmation(function(){var e=_.findIndex(s.website.highlights,function(e){return e.highlightId===s.highlight.highlightId});i.postWindowMessage({id:"LOG_EVENT",event:"IF_DELETE_IMAGE"}),i.postWindowMessage({id:"DELETE_IMAGE",deletingWebsite:!1,folderId:s.activeFolder.folderId,websiteId:s.website.websiteId,imageIds:[s.highlight.highlightId]}),s.website.highlights.splice(e,1)})},s.copySuccess=function(){i.postWindowMessage({id:"LOG_EVENT",event:"IF_COPY_HIGHLIGHT"}),i.sendNotification("COPY_HIGHLIGHT")},s.copyFail=function(){},s._getUserMeta=function(t){return t?_.find(s.activeFolderUserMeta,function(e){return e.uid===t}):null},s.getCreatorPhotoUrl=function(){var e=s._getUserMeta(s.highlight.creator);return e&&e&&e.photoURL||s.ANONOYMOUS_PHOTO_PATH},s.getCreatorName=function(){var e=s._getUserMeta(s.highlight.creator);return e&&e&&e.displayName||s.ANONOYMOUS_NAME},s.getCreatorIconPos=function(){var e=document.getElementById(s.highlight.highlightId+"-text-wrapper");return e&&e.offsetHeight?s.isOverflown?e.offsetHeight+9:e.offsetHeight-6:0},s.getHighlightColorCode=function(e){return e&&e<=s.colorCodes.length?s.colorCodes[e-1]:s.DEFAULT_IMAGE_COLOR_CODE}}}}]),angular.module("pdfUpload",[]).directive("pdfUpload",["$rootScope","contentScript","$http","$window",function(i,n,e,s){return{restrict:"A",scope:{clickSrc:"=",user:"="},link:function(t,e,o){e.bind("click",function(e){if(t.user.isAnonymous)return n.postWindowMessage({id:"LOG_EVENT",event:"ANONYMOUS_BLOCK",meta:{reason:"UPLOAD_PDF"}}),n.postWindowMessage({id:"SHOW_UPGRADE_ANONYMOUS_MODAL"}),e.preventDefault(),void e.stopPropagation();"header"===t.clickSrc?n.postWindowMessage({id:"LOG_EVENT",event:"[PDF Storage] UPLOAD_PDFS_CLICKED_VIA_HEADER_BUTTON"}):n.postWindowMessage({id:"LOG_EVENT",event:"[PDF Storage] UPLOAD_PDFS_CLICKED_VIA_WEBSITE_LIST_BUTTON"}),e.target.parentNode.reset(),n.postWindowMessage({id:"FETCH_TOKEN"}),s.open(i.StaticConstants.APP_BASE_PATH+"app/dashboard?action=uploadPdf","_blank")})}}}]),angular.module("websiteList",[]).directive("websiteList",["$rootScope","contentScript","$filter","clipboard",function(n,s,i,e){return{restrict:"E",scope:{user:"=",activeFolder:"=",hidingHighlightsWebpages:"=",websiteList:"=",colorCodes:"=",activeColorFilters:"=",showMenu:"=",showInput:"=",activeFolderUserMeta:"=",toggleEditPanel:"=",toggleNewCollectionInput:"="},templateUrl:"views/websiteList.html",link:function(r,e,t){r.StaticConstants=n.StaticConstants,r.DEFAULT_IMAGE_COLOR_CODE="#323232",r.dragging=!1,r.noteSavingState=null,r.editPanelStyle={top:80},r.deleteConfirmModalShown=!1,r.folderForm={title:"",loading:!1},r.onCancelInput=function(){r.folderForm={title:""},r.toggleNewCollectionInput(!1)},r.$watch("activeFolder",function(){r.folderForm={title:"",loading:!1},r.toggleNewCollectionInput(!1)}),r.getWebsiteTitleHtml=function(e){var t=e.title;if(r.activeFolder.searchState.searchResult.websiteIds)for(var o=0;o<r.activeFolder.searchState.searchResult.websiteIds.length;o++)if(e.websiteId===r.activeFolder.searchState.searchResult.websiteIds[o].websiteId)for(var i=_.uniq(r.activeFolder.searchState.searchResult.websiteIds[o].matchedTexts),n=0;n<i.length;n++){var s=i[n];s=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),t=t.replace(new RegExp("("+s+")","g"),"<!_!>$1</span>")}return t=(t=t.replace(new RegExp("<!_!>","g"),'<span class="search-match">')).replace(new RegExp("</!_!>","g"),"</span>")},r.onSubmit=function(){if(r.user.isAnonymous)return s.postWindowMessage({id:"LOG_EVENT",event:"ANONYMOUS_BLOCK",meta:{reason:"CREATE_NESTED_FOLDER"}}),void s.postWindowMessage({id:"SHOW_UPGRADE_ANONYMOUS_MODAL"});r.folderForm.loading=!0,s.postWindowMessage({id:"CREATE_NESTED_FOLDER",parentId:r.activeFolder.folderId,title:r.folderForm.title})},r.triggerDeleteConfirmation=function(e){r.deleteConfirmModalShown=!0,r.deleteFunction=e},r.showWebsiteOrNot=function(e){if(0===r.activeColorFilters.length)return!0;var t=!1;return _.forEach(e.highlights,function(e){-1!==r.activeColorFilters.indexOf(e.colorNum)&&(t=!0)}),t},r.toggleWebsiteHighlights=function(e,t){if(e.stopPropagation(),!r.dragging){var o=r.hidingHighlightsWebpages.indexOf(t);-1===o?r.hidingHighlightsWebpages.push(t):r.hidingHighlightsWebpages.splice(o,1)}},r.isPDFFromExtension=function(e){return-1!==e.indexOf("chrome-extension://cbnaodkpfinfiipjblikofhlhlcickei/src/pdfviewer/web/viewer.html?file=")},r.getFavIconUrl=function(e){return e.favIconUrl&&0===e.favIconUrl.indexOf("https://")?e.favIconUrl:"https://www.google.com/s2/favicons?domain="+e.url},r.getPDFFileNameFromURL=function(e,t){var o=/[^\/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=/^(?:([^:]+:)?\/\/[^\/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(e),n=o.exec(i[1])||o.exec(i[2])||o.exec(i[3]);if(n&&-1!==(n=n[0]).indexOf("%"))try{n=o.exec(decodeURIComponent(n))[0]}catch(e){}return n||t},r.getWebsiteTitle=function(e,t){return r.isPDFFromExtension(t)?r.getPDFFileNameFromURL(t,e):e},r.getColorsOfWebsite=function(e){return _.uniq(_.map(e,function(e){return e.colorNum}))},r.getHighlightColorCode=function(e){return e&&e<=r.colorCodes.length?r.colorCodes[e-1]:r.DEFAULT_IMAGE_COLOR_CODE},r.deleteFunction=null,r.confirmDelete=function(){r.deleteConfirmModalShown=!1,r.deleteFunction(),r.deleteFunction=null},r.cancelDelete=function(){r.deleteConfirmModalShown=!1,r.deleteFunction=null},r.hoverShareWebsite=function(e){s.postWindowMessage({id:"LOG_EVENT",event:"IF_HOVER_SHARE_WEBSITE"})},r.shareWebsite=function(e,t){e.stopPropagation(),s.postWindowMessage({id:"LOG_EVENT",event:"IF_SHARE_WEBSITE"});var o=_.findIndex(r.activeFolder.websites,function(e){return e.websiteId===t}),i=r.activeFolder.websites[o];s.postWindowMessage({id:"SHOW_SHARE_WEBSITE_MODAL",folderId:r.activeFolder.folderId,websiteId:t,highlightIds:_.map(i.highlights,function(e){return e.highlightId})})},r.deleteWebsite=function(e,i){r.deleteConfirmModalShown=!0,e.stopPropagation(),r.deleteFunction=function(){s.postWindowMessage({id:"LOG_EVENT",event:"IF_DELETE_WEBSITE"});var e=_.findIndex(r.activeFolder.websites,function(e){return e.websiteId===i}),t=r.activeFolder.websites[e];if(t){s.postWindowMessage({id:"DELETE_WEBSITE",folderId:r.activeFolder.folderId,websiteId:i,highlightIds:_.map(t.highlights,function(e){return e.highlightId})});var o=_.reduce(t.highlights,function(e,t){return"image"===t.type&&e.push(t.highlightId),e},[]);0!==o.length&&s.postWindowMessage({id:"DELETE_IMAGE",deletingWebsite:!0,imageIds:o}),n.loading.mainPanel=!1}r.activeFolder.websites.splice(e,1)}},r.goToWebsite=function(e,t,o){r.dragging||n.openOrSwitchToUrl(e,t,o)},r.highlightsCount=function(e){return Object.keys(e).length},r.goToDashboard=function(){n.openOrSwitchToUrl("https://www.weavatools.com/app/dashboard/")},r.getFavIcon=function(e,t){return e||"https://www.google.com/s2/favicons?domain="+t},r.formatTime=function(e){var t=Math.abs(i("amDifference")(e,null,"day")),o=Math.abs(i("amDifference")(e,null,"year"));return 0===t?i("amDateFormat")(e,"h:mm a"):0===o?i("amDateFormat")(e,"Do MMM"):i("amDateFormat")(e,"Do MMM YYYY")},r.getLatestHighlightDate=function(e){return r.formatTime(e.createDate)},r.loadingMoreWebsites=function(){return r.previousWebsiteCount&&r.currentWebsiteCount()!==r.maxWebsiteCount()&&r.previousWebsiteCount===r.currentWebsiteCount()},r.previousWebsiteCount=null,r.nextPage=function(){r.previousWebsiteCount=r.currentWebsiteCount(),r.$apply(),s.postWindowMessage({id:"WEBSITE_LIST_NEXT_PAGE"})},r.canLoadMore=function(){return!(r.loadingMoreWebsites()||!r.activeFolder||!r.activeFolder.websiteIds||r.activeFolder.searchState.searching)&&r.currentWebsiteCount()<=Object.keys(r.activeFolder.websiteIds).length-1},r.maxWebsiteCount=function(){return r.activeFolder&&r.activeFolder.websiteIds?Object.keys(r.activeFolder.websiteIds).length:0},r.currentWebsiteCount=function(){return r.activeFolder.websites.length},r.signOut=function(){r.user.isAnonymous?confirm("Are you sure to signout? All data in this trial account will be lost.")&&(s.postWindowMessage({id:"LOG_EVENT",event:"IF_LOGOUT"}),s.postWindowMessage({id:"HIDE_IFRAME_MENU"}),s.postWindowMessage({id:"SIGN_OUT",title:$scope.newFolderName})):(s.postWindowMessage({id:"LOG_EVENT",event:"IF_LOGOUT"}),s.postWindowMessage({id:"HIDE_IFRAME_MENU"}),s.postWindowMessage({id:"SIGN_OUT",title:$scope.newFolderName})),r.toggleAccountPopover()},r.$on("$destroy",function(){window.removeEventListener("wheel",r.wheelHandler)}),r.switchFolder=function(e){n.currentSwitchingFolderId=e,n.search.show=!1,s.postWindowMessage({id:"LOG_EVENT",event:"SWITCH_FOLDER",meta:{source:"MAIN_PANEL",isRoot:!1}}),s.postWindowMessage({id:"SWITCH_FOLDER",folderId:e})},r.scrollTimeout=null,r.wheelHandler=function(t){clearTimeout(r.scrollTimeout),t.stopPropagation(),r.scrollTimeout=setTimeout(function(){var e=$(".gistnote-main-panel");!r.loadingMoreWebsites()&&r.canLoadMore()&&(0<t.deltaY&&e.scrollTop()+e.innerHeight()>=.75*e[0].scrollHeight?r.nextPage():Math.abs(e.innerHeight()-e[0].scrollHeight)<2&&r.nextPage())},200)},window.addEventListener("wheel",r.wheelHandler)}}}]);var contentScriptFact=angular.module("contentScript",[]);contentScriptFact.factory("contentScript",["$rootScope","models","$location","$timeout",function(o,i,n,e){"use strict";var t={init:function(){o.showMenu=!1,o.pinMode={value:!1},o.currentUrl="",o.login=!1,o.connection=!0,o.locationPath={path:"LOGIN",errorMessage:""},o.loading={mainPanel:!1,menuPanel:!1},o.search={show:!1,input:""},o.showShareModal=!1,o.accountsPopoverClass="",o.draggingFolder=!1,window.addEventListener("message",t._messageListener),window.addEventListener("dragend",function(){o.draggingFolder=!1})},_messageListener:function(e){var t=e.data;switch(t.id){case"SIDEBAR_IFRAME_SYNC_STATES":o.showMenu=t.states.sidebarMenuDisplayState,o.pinMode.value="PINNED"===t.states.sidebarDisplayState,o.currentUrl=t.states.currentUrl,o.connection=t.states.connectionStatus,o.locationPath=t.states.locationPath,o.StaticConstants=t.StaticConstants,o.token=t.states.token,n.path(t.states.locationPath.path).replace(),!o.showMenu&&o.showShareModal&&(o.showShareModal=!1,o.loading.mainPanel=!1,o.loading.menuPanel=!1);break;case"SIDEBAR_IFRAME_SYNC_MODELS":o.login=null!=t.states.user,i.set(t.states);break;case"ACTIVATE_NEW_COLLECTION_INPUT_AREA":$("#gistnote-new-web-collection-input").focus();break;default:return}o.$apply()},postWindowMessage:function(e){e.source="Sidebar Iframe",window.parent.postMessage(e,"*")},sendNotification:function(e){t.postWindowMessage({id:"CREATE_NOTIFICATION",notificationMessage:e})}};return t}]);var modelFactory=angular.module("models",[]);modelFactory.factory("models",["$rootScope","$timeout","$location",function(i,e,t){"use strict";var n={user:null,folderList:{},activeFolder:null,colorCodes:null,workspace:null,onboarding:null,statistics:{},subscription:null,collaboratorMeta:null,activeFolderUserMeta:null,invited:null,chanageEvent:"MODELS_CHANGED",subscribe:function(e,t){var o=i.$on(n.chanageEvent,t);e.$on("$destroy",o)},notify:function(){i.$emit(n.chanageEvent)},_handleFolder:function(t){var e=[];return t.activeWebsite&&!t.searchState.searching&&(t.activeWebsite.active=!0,e.push(n._handleWebsite(t.activeWebsite)),t.websites=_.filter(t.websites,function(e){return e.websiteId!==t.activeWebsite.websiteId})),t.websites=e.concat(_.map(t.websites,n._handleWebsite)),t},_handleWebsite:function(e){return e.highlights=_.filter(e.highlights,function(e,t){return"TO_BE_REMOVED"!==(e=n._handleHighlight(e,t)).status}),e},_handleHighlight:function(e,t){return e.highlightId=t,e},set:function(e){n.questionnaire=e.questionnaire,n.subscription=e.subscription,n.workspace=e.workspace,n.onboarding=e.onboarding,n.statistics=e.statistics,n.user=e.user,n.folderList=e.folderList,n.colorCodes=e.colorCodes,n.COLOR_PROFILE=e.COLOR_PROFILE,n.activeFolder=e.activeFolder?n._handleFolder(e.activeFolder):null,n.sharingFolderUserMeta=e.sharingFolderUserMeta,n.sharingFolderInvitedMeta=e.sharingFolderInvitedMeta,n.activeFolderUserMeta=e.activeFolderUserMeta,n.folderInvitations=e.folderInvitations,n.userMeta=e.userMeta,n.notify()},folderEditUiUpdate:function(e,t,o,i){e===n.activeFolder.folderId&&(n.activeFolder.title=t,n.activeFolder.colorTags=o,n.activeFolder.colorCodes=i,n.activeFolder.folderId=e),n.folderList[e]&&(n.folderList[e].title=t,n.folderList[e].colorTags=o,n.folderList[e].colorCodes=i),n.notify()}};return n}]),angular.module("RecursionHelper",[]).factory("RecursionHelper",["$compile",function(s){return{compile:function(e,o){angular.isFunction(o)&&(o={post:o});var i,n=e.contents().remove();return{pre:o&&o.pre?o.pre:null,post:function(e,t){i||(i=s(n)),i(e,function(e){t.append(e)}),o&&o.post&&o.post.apply(null,arguments)}}}}}]);var gistnoteSearchFilter=angular.module("gistnoteSearchFilter",[]);gistnoteSearchFilter.filter("gistnoteWebsitesOrdering",["$filter",function(e){"use strict";return function(e,t,o){if(!e)return[];if(o.searching)return s=_.sortBy(e,function(e){return-e.score});var i=_.findIndex(e,function(e){return e.active}),n=null,s=[];return s=-1!==i?(n=e[i],_.filter(e,function(e){return!e.active})):e,s=_.sortBy(s,function(e){return t?e.createDate:-e.createDate}),n&&(s=[n].concat(s)),s}}]);